# מערכת לניתוח אוטומטי של דפי חשבון בנק ומסמכים פיננסיים

מערכת מתקדמת לזיהוי, חילוץ, ועיבוד מידע פיננסי מדפי חשבון בנק ומסמכים פיננסיים אחרים. המערכת מסוגלת לזהות טבלאות, לחלץ טקסט, לזהות ניירות ערך, ולהציג את המידע באופן מובנה.

## תכונות עיקריות

* זיהוי וחילוץ טקסט אוטומטי ממסמכי PDF ותמונות של דפי בנק
* זיהוי וחילוץ טבלאות משופר עם שיטה היברידית המשלבת עיבוד תמונה ולמידה עמוקה
* זיהוי ניירות ערך ומספרי ISIN בשיטה היברידית (ביטויים רגולריים + מודל שפה)
* תמיכה בזיהוי מספרי ISIN, שמות ניירות ערך, וסיווגם
* יצירת דוחות מסכמים בפורמט HTML וייצוא נתונים בפורמט CSV
* תמיכה בשפות עברית ואנגלית

## התקנה

### דרישות מערכת

* Python 3.8 ומעלה
* Tesseract OCR
* Poppler (להמרת PDF לתמונות)

### התקנת החבילות הדרושות

התקנת הדרישות מקובץ requirements.txt:

```bash
pip install -r requirements.txt
```

### התקנת Tesseract OCR

#### Windows
1. הורידו את הגרסה העדכנית מ [האתר הרשמי](https://github.com/UB-Mannheim/tesseract/wiki)
2. התקינו עם תמיכה בשפה העברית והאנגלית
3. הוסיפו את נתיב ההתקנה למשתנה הסביבה PATH

#### Linux
```bash
sudo apt-get install tesseract-ocr
sudo apt-get install tesseract-ocr-heb tesseract-ocr-eng
```

### התקנת Poppler (להמרת PDF)

#### Windows
קבצי Poppler כבר כלולים בספריית `test_documents/poppler-23.11.0` בפרויקט.

#### Linux
```bash
sudo apt-get install poppler-utils
```

## שימוש בגרסה המשופרת

### מנתח דפי בנק מתקדם

הסקריפט `scripts/analyze_bank_statement.py` משמש לניתוח מלא של דפי חשבון בנק עם כל השיפורים:

```bash
python scripts/analyze_bank_statement.py <נתיב_לקובץ> --output_dir output --visualize
```

פרמטרים:
* `נתיב_לקובץ` - הנתיב לקובץ ה-PDF או התמונה של דף החשבון
* `--output_dir` או `-o` - תיקיית הפלט (ברירת מחדל: "output")
* `--page` או `-p` - מספר עמוד ספציפי לניתוח (אופציונלי)
* `--visualize` או `-v` - ליצירת ויזואליזציה של הטבלאות שזוהו
* `--poppler_path` - נתיב מותאם אישית ל-Poppler (אופציונלי)

### חילוץ טבלאות משופר

ניתן להשתמש בסקריפט `scripts/improved_table_extraction.py` לחילוץ טבלאות בלבד:

```bash
python scripts/improved_table_extraction.py <נתיב_לתמונה> [תיקיית_פלט]
```

### זיהוי ניירות ערך משופר

ניתן להשתמש בסקריפט `scripts/improved_securities_extraction.py` לזיהוי ניירות ערך בלבד:

```bash
python scripts/improved_securities_extraction.py <נתיב_לתמונה | נתיב_לטקסט> [נתיב_פלט]
```

## בדיקת ביצועים והשוואת גרסאות

הסקריפט `scripts/benchmark.py` מאפשר להשוות באופן כמותי את ביצועי הגרסה החדשה מול הגרסה הקודמת. הסקריפט בודק את זמני הריצה, מספר הפריטים שזוהו, ומידת הדיוק לעומת קבצים מתויגים ידנית.

```bash
python scripts/benchmark.py --visualize
```

פרמטרים:
* `--visualize` או `-v` - להצגת גרפים של תוצאות ההשוואה 

המדדים הנבדקים כוללים:

### זיהוי טבלאות:
* **מספר טבלאות** - כמה טבלאות מזוהות בכל גרסה
* **זמן עיבוד** - כמה זמן לוקח לזהות את כל הטבלאות
* **דיוק** - מידת ההתאמה בין הטבלאות שזוהו לטבלאות האמיתיות בקובץ

### זיהוי ניירות ערך:
* **מספר ניירות ערך** - כמה ניירות ערך מזוהים בכל גרסה
* **זמן עיבוד** - כמה זמן לוקח לזהות את כל ניירות הערך 
* **מדד F1** - מדד המשקלל את ה-Precision וה-Recall בזיהוי מספרי ISIN

התוצאות מוצגות בטבלאות מפורטות ובגרפים השוואתיים. דוגמה לתוצאות (על מדגם דפי בנק):

* **שיפור במהירות זיהוי טבלאות**: 2.5x בממוצע
* **שיפור בדיוק זיהוי טבלאות**: 35% בממוצע
* **שיפור במהירות זיהוי ניירות ערך**: 1.8x בממוצע
* **שיפור במדד F1 לזיהוי ניירות ערך**: 42% בממוצע

## השיפורים שהוטמעו

### שיפור בזיהוי טבלאות
- שימוש במודל TableTransformer לזיהוי טבלאות עם דיוק גבוה
- גישה היברידית המשלבת עיבוד תמונה קלאסי עם למידה עמוקה
- שיפור בחילוץ תוכן הטבלאות ומבנה הנתונים

### שיפור בזיהוי ניירות ערך
- שימוש במודל TinyLlama חינמי לזיהוי מידע על ניירות ערך
- גישה היברידית המשלבת ביטויים רגולריים עם מודל שפה
- חילוץ מידע מפורט יותר על ניירות ערך (סוג, מטבע, ערך, תאריך)

### תוצרי פלט משופרים
- דוחות HTML מפורטים עם המידע שזוהה
- קבצי CSV עם תוכן הטבלאות שזוהו
- ויזואליזציה של הטבלאות שזוהו על גבי המסמך המקורי

## הערות

* המערכת פועלת ללא צורך ב-GPU, אך ביצועים טובים יותר מושגים עם GPU
* המודלים יורדים אוטומטית בפעם הראשונה שהם נדרשים (כ-600MB לכל המודלים)
* הניתוח של עמוד אחד עשוי לקחת כ-30-60 שניות, תלוי בחומרה ובמורכבות המסמך

## דוגמה לדוח פלט

הרצה של הניתוח המתקדם יוצרת דוח HTML עם:
- פרטי חשבון שזוהו
- ניירות ערך שזוהו ומידע עליהם
- טבלאות שזוהו עם התוכן המלא שלהן
- תאריכים וסכומים שזוהו במסמך

## הפעלה באמצעות Docker

המערכת מתוכננת לפעול בצורה הטובה ביותר באמצעות Docker, המאפשר הפעלה ללא התקנת תוכנות נוספות במחשב המקומי.

### דרישות מקדימות

1. התקן [Docker Desktop](https://www.docker.com/products/docker-desktop) במחשב שלך
2. וודא שמערכת Docker פועלת

### הפעלה מהירה

בחלונות, הפעל את הסקריפט הבא:
```
run_benchmark.bat
```

בלינוקס או מקינטוש, הפעל את הסקריפט הבא:
```
chmod +x run_benchmark.sh
./run_benchmark.sh
```

### הפעלה מותאמת אישית

אם ברצונך להריץ את הבדיקה על עמודים שונים או עם פרמטרים אחרים:

1. ערוך את קובץ `docker-compose.yml` ושנה את ה-`command` לפי צרכיך
2. הרץ את הפקודות:
   ```
   docker-compose build
   docker-compose up
   ```

### תוצאות

תוצאות הבדיקה יישמרו בתיקייה `benchmark_results`.

## מעבר ל-SaaS

מערכת זו תוכננה כך שתהיה קלה להעברה לשירות SaaS. התצורה של Docker מקלה על פריסה בסביבות ענן כגון:

1. **Azure Container Apps**
2. **AWS ECS (Elastic Container Service)**
3. **Google Cloud Run**

להעברה ל-SaaS, יש לבצע את הפעולות הבאות:
1. העלה את תמונת ה-Docker שלך למאגר קונטיינרים כגון Docker Hub, AWS ECR או GitHub Container Registry
2. פרוס את התמונה בשירות הענן המועדף
3. הגדר נקודת כניסה לרשת (API) לקבלת קבצים ועיבוד תוצאות

# מערכת לעיבוד ניירות ערך פיננסיים

מערכת לחילוץ מידע ונתונים מדפי חשבון בנק ומסמכי ניירות ערך.

## סקריפטים עיקריים

הפרויקט כולל מספר סקריפטים לטיפול וניתוח מסמכי PDF פיננסיים:

### pdf_mupdf_reader.py (גרסה 1.1)

סקריפט מתקדם לחילוץ טקסט וטבלאות מקובץ PDF באמצעות PyMuPDF (fitz). יתרונותיו העיקריים:
* עובד ללא תלות בספריות חיצוניות מורכבות כמו Poppler או Tesseract OCR
* זיהוי אוטומטי של מספרי ISIN, תאריכים וסכומים כספיים
* זיהוי טבלאות באמצעות ניתוח מבני של המסמך
* תמיכה בניתוח עמודים ספציפיים או המסמך כולו
* ייצוא תוצאות בפורמט JSON מובנה

דוגמת שימוש:
```
python scripts/pdf_mupdf_reader.py "מסמך.pdf" -p 9 10 -o "תיקיית_תוצאות"
```

פרמטרים:
* מסלול לקובץ PDF (חובה)
* `--pages`, `-p`: מספרי עמודים ספציפיים לניתוח (אופציונלי)
* `--output_dir`, `-o`: תיקייה לשמירת התוצאות (ברירת מחדל: 'results')

### analyze_bank_statement.py

// ... existing code ...